<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>iban-check.org – IBAN ⇄ DNS Hash Checker</title>
    <style>
        *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
        body{display:grid;place-items:center;min-height:100vh;margin:0;background:#f5f7fa}
        form{background:#fff;padding:2rem 3rem;border-radius:1rem;box-shadow:0 4px 20px rgba(0,0,0,.1);width:clamp(300px,90vw,480px)}
        h1{margin-top:0;font-size:1.4rem;text-align:center}
        label{display:block;margin:1rem 0 .4rem;font-weight:600}
        input{width:100%;padding:.6rem .8rem;border:1px solid #c3c7cf;border-radius:.5rem;font-size:1rem}
        button{margin-top:1.4rem;width:100%;padding:.8rem;border:0;border-radius:.5rem;font-size:1rem;font-weight:600;cursor:pointer;background:#2563eb;color:#fff}
        button:disabled{background:#a5b4fc;cursor:not-allowed}
        .result{margin-top:1.4rem;padding:1rem;border-radius:.5rem;font-size:.95rem}
        .ok{background:#d1fae5;color:#065f46;border:1px solid #34d399}
        .fail{background:#fee2e2;color:#b91c1c;border:1px solid #f87171}
        .warn{background:#fef9c3;color:#92400e;border:1px solid #fde047}
    </style>
</head>
<body>
    <form id="form">
        <h1>iban-check.org – IBAN → SHA‑256 bei DNS vergleichen</h1>
        <label for="iban">IBAN</label>
        <input id="iban" name="iban" placeholder="DE12 3456 7890 1234 5678 90" required>

        <label for="domain">Domain</label>
        <input id="domain" name="domain" placeholder="example.com" required>

        <button type="submit">prüfen</button>
        <div id="output"></div>
    </form>

<!-- Fallback-Lib für unsichere Kontexte / ältere Browser -->
<script src="https://cdn.jsdelivr.net/npm/js-sha256@0.9.0/build/sha256.min.js"></script>
<script>
const output = document.getElementById('output');
const form   = document.getElementById('form');

// SHA-256: WebCrypto oder Fallback-Bibliothek
async function sha256Hex(str){
  const clean = str.replace(/\s+/g,'');
  if (window.crypto && crypto.subtle){
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(clean));
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
  }
  if (typeof sha256 === 'function'){
      return sha256(clean).toLowerCase();
  }
  throw new Error('SHA-256 nicht verfügbar');
}

// TXT-Lookup mit DNSSEC-Flag
async function txtRecords(name){
  const r = await fetch(`https://dns.google/resolve?name=${name}&type=TXT&do=1`);
  if (!r.ok) throw new Error('DNS Lookup fehlgeschlagen');
  const j = await r.json();
  return {
    answers: (j.Answer || []).map(a => a.data.replace(/(^"|"$)/g,'')),
    dnssecOK: j.AD === true               // Authenticated-Data-Flag
  };
}

form.addEventListener('submit', async ev => {
  ev.preventDefault();
  output.className = 'result warn';
  output.textContent = '⏳ Prüfe …';

  try{
      const iban    = form.iban.value.trim();
      const domain  = form.domain.value.trim().toLowerCase();
      const ibanHex = await sha256Hex(iban);

      // _iban … _iban10
      const labels   = Array.from({length:10}, (_,i)=> i===0 ? '_iban' : `_iban${i+1}`);
      const lookups  = await Promise.all(labels.map(l => txtRecords(`${l}.${domain}`)));

      const txtLines = lookups.flatMap(l => l.answers);
      const records  = txtLines.map(t => Object.fromEntries(
                            t.split(';').map(s=>s.trim()).map(p=>p.split('=').map(x=>x.trim().toLowerCase()))
                        )).filter(o => o.v==='1' && o.k==='sha256' && o.hash);

      const match    = records.find(o => o.hash.toLowerCase() === ibanHex);
      const dnssecOK = lookups.some(l => l.dnssecOK);

      if (match){
          if (dnssecOK){
              output.className = 'result ok';
              output.textContent = '✅ Übertragung sicher und Hash vorhanden (DNSSEC geprüft)';
          }else{
              output.className = 'result warn';
              output.textContent = '⚠️ Hash stimmt, aber Übertragung unsicher (keine DNSSEC-Signatur)';
          }
      }else{
          output.className = 'result fail';
          output.textContent = '❌ Kein passender Hash gefunden.';
      }
  }catch(err){
      output.className = 'result fail';
      output.textContent = 'Fehler: ' + err.message;
  }
});
</script>

</body>
</html>
